<!doctype html>
<html lang="en"><head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Dashboard - FRESH</title>
<link rel="stylesheet" href="/assets/styles.css"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script defer src="/assets/app.js"></script>
</head><body>

<header>
  <div class="logo"><span class="dot"></span><span>FRESH</span> <small class="mono" style="color:#9aa0a6">After‑Sales</small></div>
  <nav>
    <a href="/index.html" class='active'>Dashboard</a>
    <a href="/pages/reports/index.html" >Reports</a>
    <a href="/pages/tech_app.html" >Technician</a>
    <a href="/pages/customer_app.html" >Customer</a>
    <a href="/pages/inventory.html" >Inventory</a>
    <a href="/pages/training.html" >Training</a>
    <a href="/pages/admin.html" >Admin</a>
  </nav>
</header>

<div class="container">

<div class="panel">
  <div class="filters">
    <select id="f-region"></select>
    <select id="f-device"></select>
    <select id="f-branch"></select>
    <select id="f-month"></select>
    <button class="btn" id="apply">Apply Filters</button>
  </div>
  <div class="grid cols-4">
    <div class="panel kpi"><div class="v" id="kpi-csat">--%</div><div><div class="l">Avg. CSAT</div></div></div>
    <div class="panel kpi"><div class="v" id="kpi-ontime">--%</div><div><div class="l">On‑time</div></div></div>
    <div class="panel kpi"><div class="v" id="kpi-revisit">--%</div><div><div class="l">Revisit</div></div></div>
    <div class="panel kpi"><div class="v" id="kpi-tickets">--</div><div><div class="l">Tickets</div></div></div>
  </div>
</div>

<div class="grid cols-2" style="margin-top:16px">
  <div class="panel chart-card"><canvas id="trend-csat"></canvas></div>
  <div class="panel chart-card"><canvas id="aging"></canvas></div>
</div>

<script>
let ch1, ch2;
function refresh(){
  const f = readFilters();
  const rows = FRESH.applyFilters(FRESH.tickets, f);

  // KPIs
  const csatAvg = (rows.reduce((a,b)=>a+b.csat,0)/(rows.length||1)).toFixed(1);
  document.getElementById('kpi-csat').textContent = csatAvg + '%';
  document.getElementById('kpi-ontime').textContent = FRESH.pctOnTime(rows) + '%';
  document.getElementById('kpi-revisit').textContent = FRESH.pctRevisit(rows) + '%';
  document.getElementById('kpi-tickets').textContent = rows.length;

  // Charts
  const trend = FRESH.monthlyTrend(rows, r=>r.csat);
  ch1 && ch1.destroy(); ch1 = mkLine(document.getElementById('trend-csat'), FRESH.months, trend, '#1e88e5');

  const aging = FRESH.agingBuckets(rows);
  ch2 && ch2.destroy(); ch2 = mkDoughnut(document.getElementById('aging'), Object.keys(aging), Object.values(aging));
}
document.getElementById('apply').addEventListener('click', refresh);
document.addEventListener('DOMContentLoaded', () => setTimeout(refresh,100));
</script>
</div>
<footer><small class="mono">FRESH After‑Sales • Static v24</small></footer>
</body></html>